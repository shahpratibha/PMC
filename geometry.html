<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PMC</title>
    <link rel="icon" href="png/pmcjpeg.png" type="image/x-icon" />

    <!-- External CSS -->
    <link rel="stylesheet" href="css/geom.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/boxicons@latest/css/boxicons.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.7/css/dataTables.bootstrap5.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-draw/dist/leaflet.draw.css" />
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" />
    <link rel="stylesheet" href="css/geom.css" />

    <!-- External JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-ajax/dist/leaflet.ajax.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.7/js/dataTables.bootstrap5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.0/jspdf.umd.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script src="https://unpkg.com/leaflet-draw/dist/leaflet.draw.js"></script>

    <style>
        .pagination {
            margin-top: 3px;
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
        }

        .pagination button {
            display: inline-block;
            width: 30px;
            height: 30px;
            padding: 0;
            margin: 0 5px;
            background-color: transparent;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            transition: background-color 0.3s, color 0.3s;
        }

        .pagination button:hover {
            background-color: #007bff;
            /* border: 1px solid black; */
        }

        .pagination button.active {
            width: 35px;
            height: 35px;
            padding: 0;
            background-color: #007bff;
            color: white;
            border: 2px solid #007bff;
            border-radius: 50%;
        }

        .pagination .arrow {
            background-color: transparent;
            border: none;
        }

        .pagination .arrow:hover {
            background-color: transparent !important;
            color: inherit;
        }

        .pagination .arrow:focus {
            outline: none;
        }

        @media print {
            body {
                size: tabloid landscape;
                margin: 10mm 10mm 10mm 10mm;
            }

            .pagination,
            .geopulseaname,
            #generatePdfBtn {
                display: none;
            }

            table {
                width: 100%;
                font-size: 10pt;
            }
        }

        .edit-button {
            display: inline-block;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            text-align: center;
            text-decoration: none;
            font-size: 10px;
            font-weight: bold;
            padding: 5px;
            margin-left: 88%;

            font-family: sans-serif !important;
            transition: background-color 0.3s ease;
        }


        .edit-button:hover {
            background-color: #0056b3;
        }

        .edit i {
            margin-right: 10px;
        }

        /* .leaflet-interactive {
            transform: scale(1.2);
        } */
    </style>


</head>

<body class="bg-light">
    <img src="png/pmcjpeg.png" alt="" class="logopng1" />
    <div id="content" style="width: 100%" class="container">
        <div id="button-container" class=""></div>

        <section id="map-section" class="">
            <form class="mt-3" style="overflow: hidden">
                <div style="margin: 0; float: left">
                    <h5 class="text-secondary">Preview Map</h5>

                </div>
                <div style="float: right; margin-top: -40px; margin-left: 95%">
                    <i class="fa-solid fa-print text-primary" id="generatePdfBtn" onclick="printPage()"
                        style="font-size: 25px"></i>
                </div>
                <div id="map"></div>
                <a class="geopulseaname"
                    style="color: darkblue; position: absolute; z-index: 99999; bottom: 0.5%; right: 0; font-weight: bold; font-size: 10px;">@GeoPulse
                    Analytics</a>
                <div id="table-container">
                    <table id="workTable" class="table table-bordered table-hover"
                        style="width: 100% !important; font-size: 10px">
                        <thead>
                            <tr>
                                <th>Attribute</th>
                                <th>Value</th>
                            </tr>
                        </thead>
                        <tbody id="workTableData">
                        </tbody>
                    </table>
                    <div id="pagination-controls" class="pagination">

                    </div>
            </form>
        </section>
    </div>

    <script>
        var map = L.map("map", {
            center: [18.52, 73.89],
            zoom: 8,
            minZoom: 9,
            maxZoom: 16,
            boxZoom: true,
            trackResize: true,
            wheelPxPerZoomLevel: 40,
            zoomAnimation: true,
            dragging: true,
            zoomControl: false,
            scrollWheelZoom: true,
            doubleClickZoom: false,
            touchZoom: false
        });

        var googleSat = L.tileLayer("http://{s}.google.com/vt/lyrs=s&x={x}&y={y}&z={z}", {
            maxZoom: 20,
            subdomains: ["mt0", "mt1", "mt2", "mt3"]
        });

        var Esri_WorldImagery = L.tileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}", {
            maxZoom: 20
        });

        var osm = L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
            maxZoom: 19
        }).addTo(map);
        var baseURL = "https://iwmsgis.pmc.gov.in/geoserver/pmc/wms";
        // var demoURL ="https://iwmsgis.pmc.gov.in/geoserver/demo/wms";
        var IWMS_line = L.tileLayer.wms(baseURL, {
            layers: "IWMS_line",
            format: "image/png",
            transparent: true,
            tiled: true,
            version: "1.1.0",
            opacity: 1
        });

        var IWMS_polygon = L.tileLayer.wms(baseURL, {
            layers: "IWMS_polygon",
            format: "image/png",
            transparent: true,
            tiled: true,
            version: "1.1.0",
            opacity: 1
        });

        var IWMS_point = L.tileLayer.wms(baseURL, {
            layers: "IWMS_point",
            format: "image/png",
            transparent: true,
            tiled: true,
            version: "1.1.0",
            opacity: 1
        });

        var Ward_layer = L.tileLayer.wms(baseURL, {
            layers: "GIS_Ward_Layer",
            format: "image/png",
            transparent: true,
            tiled: true,
            version: "1.1.0",
            opacity: 1
        });

        var WMSlayers = {
            "Esri": Esri_WorldImagery,
            "Satellite": googleSat,
            "osm": osm,
            "IWMS_line": IWMS_line,
            "IWMS_polygon": IWMS_polygon,
            "IWMS_point": IWMS_point,
            "Ward_layer": Ward_layer
        };

        var control = new L.control.layers({}, WMSlayers).addTo(map);
        control.setPosition('topright');

        var highlightLayer;

        const API_URL = "http://localhost/IWMS_test2/";
        // const API_URL = "http://localhost/PMC/IWMS_main/";
        // const API_URL = "https://iwmsgis.pmc.gov.in/gis/iwms/";
        // const API_URL = "https://iwmsgis.pmc.gov.in/gis/test/";  

        async function onClickEdit(department, id, Work_ID) {

            const response = await fetch(`https://iwms.punecorporation.org/api/project-gis-data?proj_id=${Work_ID}`);

            //  const response = await fetch('api-responses/all-project-data.json');
            const projectData = await response.json();
            const project = projectData.data;

            const conceptual = await fetch(`${API_URL}APIS/Get_Conceptual_Form_By_Work_Id.php?works_approval_id=${Work_ID}`);
            const resConceptual = await conceptual.json();
            const conceptualData = resConceptual.data;

            if (conceptualData.struct_no > 10) {


                const baseURL = "ward.html";

                // Create the query string
                const queryString = `?proj_id=${encodeURIComponent(Work_ID)}&lastInsertedId=${encodeURIComponent(conceptualData.id)}&width=${encodeURIComponent(conceptualData.width)}&length=${encodeURIComponent(conceptualData.length)}&wardName=${encodeURIComponent(conceptualData.ward)}&department=${encodeURIComponent(department)}&workType=${encodeURIComponent(conceptualData.work_type)}&struct_no=${encodeURIComponent(conceptualData.struct_no)}&user_id=${encodeURIComponent(conceptualData.struct_no)}&zone_id=${encodeURIComponent(project.gis_zone_id)}&ward_id=${encodeURIComponent(project.gis_ward_id)}&prabhag_id=${encodeURIComponent(project.gis_prabhag_id)}&edit="true"&editId=${encodeURIComponent(id ? String(id).replace(/"/g, '') : '')}`;

                // Redirect to the new URL with query parameters
                window.location.href = baseURL + queryString;
            }

            if (department == "Road") {


                const baseURL = "road.html";

                console.log(id, "idd")
                // Create the query string
                const queryString = `?proj_id=${encodeURIComponent(Work_ID)}&lastInsertedId=${encodeURIComponent(conceptualData.id)}&width=${encodeURIComponent(conceptualData.width)}&length=${encodeURIComponent(conceptualData.length)}&wardName=${encodeURIComponent(conceptualData.ward)}&department=${encodeURIComponent(department)}&workType=${encodeURIComponent(conceptualData.work_type)}&struct_no=${encodeURIComponent(conceptualData.struct_no)}&user_id=${encodeURIComponent(conceptualData.struct_no)}&zone_id=${encodeURIComponent(project.gis_zone_id)}&ward_id=${encodeURIComponent(project.gis_ward_id)}&prabhag_id=${encodeURIComponent(project.gis_prabhag_id)}&edit="true"&editId=${encodeURIComponent(id ? String(id).replace(/"/g, '') : '')}`;

                // Redirect to the new URL with query parameters
                window.location.href = baseURL + queryString;
            }

            else if (department === "Building") {


                const baseURL = "building.html";

                // Create the query string
                const queryString = `?proj_id=${encodeURIComponent(Work_ID)}&lastInsertedId=${encodeURIComponent(conceptualData.id)}&width=${encodeURIComponent(conceptualData.width)}&length=${encodeURIComponent(conceptualData.length)}&wardName=${encodeURIComponent(conceptualData.ward)}&department=${encodeURIComponent(department)}&workType=${encodeURIComponent(conceptualData.work_type)}&struct_no=${encodeURIComponent(conceptualData.struct_no)}&user_id=${encodeURIComponent(conceptualData.struct_no)}&zone_id=${encodeURIComponent(project.gis_zone_id)}&ward_id=${encodeURIComponent(project.gis_ward_id)}&prabhag_id=${encodeURIComponent(project.gis_prabhag_id)}&edit="true"&editId=${encodeURIComponent(id ? String(id).replace(/"/g, '') : '')}`;

                // Redirect to the new URL with query parameters
                window.location.href = baseURL + queryString;
            }

            // 4) drainage------------------------------
            else if (department === "Drainage") {


                const baseURL = "drainage.html";

                // Create the query string
                const queryString = `?proj_id=${encodeURIComponent(Work_ID)}&lastInsertedId=${encodeURIComponent(conceptualData.id)}&width=${encodeURIComponent(conceptualData.width)}&length=${encodeURIComponent(conceptualData.length)}&wardName=${encodeURIComponent(conceptualData.ward)}&department=${encodeURIComponent(department)}&workType=${encodeURIComponent(conceptualData.work_type)}&struct_no=${encodeURIComponent(conceptualData.struct_no)}&user_id=${encodeURIComponent(conceptualData.struct_no)}&zone_id=${encodeURIComponent(project.gis_zone_id)}&ward_id=${encodeURIComponent(project.gis_ward_id)}&prabhag_id=${encodeURIComponent(project.gis_prabhag_id)}&edit="true"&editId=${encodeURIComponent(id ? String(id).replace(/"/g, '') : '')}`;

                // Redirect to the new URL with query parameters
                window.location.href = baseURL + queryString;
            }
            // 5)water-supply-------------------------
            else if (department === "Water Supply") {


                const baseURL = "water-suppy.html";

                // Create the query string
                const queryString = `?proj_id=${encodeURIComponent(Work_ID)}&lastInsertedId=${encodeURIComponent(conceptualData.id)}&width=${encodeURIComponent(conceptualData.width)}&length=${encodeURIComponent(conceptualData.length)}&wardName=${encodeURIComponent(conceptualData.ward)}&department=${encodeURIComponent(department)}&workType=${encodeURIComponent(conceptualData.work_type)}&struct_no=${encodeURIComponent(conceptualData.struct_no)}&user_id=${encodeURIComponent(conceptualData.struct_no)}&zone_id=${encodeURIComponent(project.gis_zone_id)}&ward_id=${encodeURIComponent(project.gis_ward_id)}&prabhag_id=${encodeURIComponent(project.gis_prabhag_id)}&edit="true"&editId=${encodeURIComponent(id ? String(id).replace(/"/g, '') : '')}`;

                // Redirect to the new URL with query parameters
                window.location.href = baseURL + queryString;
            }

            // 6) Electrical---------------------

            else if (department === "Electrical") {


                const baseURL = "electric-work.html";

                // Create the query string
                const queryString = `?proj_id=${encodeURIComponent(Work_ID)}&lastInsertedId=${encodeURIComponent(conceptualData.id)}&width=${encodeURIComponent(conceptualData.width)}&length=${encodeURIComponent(conceptualData.length)}&wardName=${encodeURIComponent(conceptualData.ward)}&department=${encodeURIComponent(department)}&workType=${encodeURIComponent(conceptualData.work_type)}&struct_no=${encodeURIComponent(conceptualData.struct_no)}&user_id=${encodeURIComponent(conceptualData.struct_no)}&zone_id=${encodeURIComponent(project.gis_zone_id)}&ward_id=${encodeURIComponent(project.gis_ward_id)}&prabhag_id=${encodeURIComponent(project.gis_prabhag_id)}&edit="true"&editId=${encodeURIComponent(id ? String(id).replace(/"/g, '') : '')}`;

                // Redirect to the new URL with query parameters
                window.location.href = baseURL + queryString;
            }
            // 7) project work-------------------------
            else if (department === "Project Work") {


                const baseURL = "project.html";

                // Create the query string
                const queryString = `?proj_id=${encodeURIComponent(Work_ID)}&lastInsertedId=${encodeURIComponent(conceptualData.id)}&width=${encodeURIComponent(conceptualData.width)}&length=${encodeURIComponent(conceptualData.length)}&wardName=${encodeURIComponent(conceptualData.ward)}&department=${encodeURIComponent(department)}&workType=${encodeURIComponent(conceptualData.work_type)}&struct_no=${encodeURIComponent(conceptualData.struct_no)}&user_id=${encodeURIComponent(conceptualData.struct_no)}&zone_id=${encodeURIComponent(project.gis_zone_id)}&ward_id=${encodeURIComponent(project.gis_ward_id)}&prabhag_id=${encodeURIComponent(project.gis_prabhag_id)}&edit="true"&editId=${encodeURIComponent(id ? String(id).replace(/"/g, '') : '')}`;

                // Redirect to the new URL with query parameters
                window.location.href = baseURL + queryString;
            }
            // 8) swm------------------------------
            else if (department === 'Solid waste Management') {


                const baseURL = "solidWasteManagement.html";

                // Create the query string
                const queryString = `?proj_id=${encodeURIComponent(Work_ID)}&lastInsertedId=${encodeURIComponent(conceptualData.id)}&width=${encodeURIComponent(conceptualData.width)}&length=${encodeURIComponent(conceptualData.length)}&wardName=${encodeURIComponent(conceptualData.ward)}&department=${encodeURIComponent(department)}&workType=${encodeURIComponent(conceptualData.work_type)}&struct_no=${encodeURIComponent(conceptualData.struct_no)}&user_id=${encodeURIComponent(conceptualData.struct_no)}&zone_id=${encodeURIComponent(project.gis_zone_id)}&ward_id=${encodeURIComponent(project.gis_ward_id)}&prabhag_id=${encodeURIComponent(project.gis_prabhag_id)}&edit="true"&editId=${encodeURIComponent(id ? String(id).replace(/"/g, '') : '')}`;

                // Redirect to the new URL with query parameters
                window.location.href = baseURL + queryString;
            }
            // 9) garden-------------------------
            else if (department === "Garden") {


                const baseURL = "garden.html";

                // Create the query string
                const queryString = `?proj_id=${encodeURIComponent(Work_ID)}&lastInsertedId=${encodeURIComponent(conceptualData.id)}&width=${encodeURIComponent(conceptualData.width)}&length=${encodeURIComponent(conceptualData.length)}&wardName=${encodeURIComponent(conceptualData.ward)}&department=${encodeURIComponent(department)}&workType=${encodeURIComponent(conceptualData.work_type)}&struct_no=${encodeURIComponent(conceptualData.struct_no)}&user_id=${encodeURIComponent(conceptualData.struct_no)}&zone_id=${encodeURIComponent(project.gis_zone_id)}&ward_id=${encodeURIComponent(project.gis_ward_id)}&prabhag_id=${encodeURIComponent(project.gis_prabhag_id)}&edit="true"&editId=${encodeURIComponent(id ? String(id).replace(/"/g, '') : '')}`;

                // Redirect to the new URL with query parameters
                window.location.href = baseURL + queryString;
            }

            // 10) garden horticulture----------------------------
            else if (department === "Garden Horticulture") {


                const baseURL = "gardenhoriculture.html";

                // Create the query string
                const queryString = `?proj_id=${encodeURIComponent(Work_ID)}&lastInsertedId=${encodeURIComponent(conceptualData.id)}&width=${encodeURIComponent(conceptualData.width)}&length=${encodeURIComponent(conceptualData.length)}&wardName=${encodeURIComponent(conceptualData.ward)}&department=${encodeURIComponent(department)}&workType=${encodeURIComponent(conceptualData.work_type)}&struct_no=${encodeURIComponent(conceptualData.struct_no)}&user_id=${encodeURIComponent(conceptualData.struct_no)}&zone_id=${encodeURIComponent(project.gis_zone_id)}&ward_id=${encodeURIComponent(project.gis_ward_id)}&prabhag_id=${encodeURIComponent(project.gis_prabhag_id)}&edit="true"&editId=${encodeURIComponent(id ? String(id).replace(/"/g, '') : '')}`;

                // Redirect to the new URL with query parameters
                window.location.href = baseURL + queryString;
            }
            // 11) encrochment=----------------------------------------
            else if (department === "Encroachment ") {


                const baseURL = "Encroachment.html";

                // Create the query string
                const queryString = `?proj_id=${encodeURIComponent(Work_ID)}&lastInsertedId=${encodeURIComponent(conceptualData.id)}&width=${encodeURIComponent(conceptualData.width)}&length=${encodeURIComponent(conceptualData.length)}&wardName=${encodeURIComponent(conceptualData.ward)}&department=${encodeURIComponent(department)}&workType=${encodeURIComponent(conceptualData.work_type)}&struct_no=${encodeURIComponent(conceptualData.struct_no)}&user_id=${encodeURIComponent(conceptualData.struct_no)}&zone_id=${encodeURIComponent(project.gis_zone_id)}&ward_id=${encodeURIComponent(project.gis_ward_id)}&prabhag_id=${encodeURIComponent(project.gis_prabhag_id)}&edit="true"&editId=${encodeURIComponent(id ? String(id).replace(/"/g, '') : '')}`;

                // Redirect to the new URL with query parameters
                window.location.href = baseURL + queryString;
            }
            // 12) education---------------------------------
            else if (department === "Education Department (Primary)") {


                const baseURL = "Education.html";

                // Create the query string
                const queryString = `?proj_id=${encodeURIComponent(Work_ID)}&lastInsertedId=${encodeURIComponent(conceptualData.id)}&width=${encodeURIComponent(conceptualData.width)}&length=${encodeURIComponent(conceptualData.length)}&wardName=${encodeURIComponent(conceptualData.ward)}&department=${encodeURIComponent(department)}&workType=${encodeURIComponent(conceptualData.work_type)}&struct_no=${encodeURIComponent(conceptualData.struct_no)}&user_id=${encodeURIComponent(conceptualData.struct_no)}&zone_id=${encodeURIComponent(project.gis_zone_id)}&ward_id=${encodeURIComponent(project.gis_ward_id)}&prabhag_id=${encodeURIComponent(project.gis_prabhag_id)}&edit="true"&editId=${encodeURIComponent(id ? String(id).replace(/"/g, '') : '')}`;

                // Redirect to the new URL with query parameters
                window.location.href = baseURL + queryString;
            }
            // 13) market--------------------------
            else if (department === "Market") {


                const baseURL = "market.html";

                // Create the query string
                const queryString = `?proj_id=${encodeURIComponent(Work_ID)}&lastInsertedId=${encodeURIComponent(conceptualData.id)}&width=${encodeURIComponent(conceptualData.width)}&length=${encodeURIComponent(conceptualData.length)}&wardName=${encodeURIComponent(conceptualData.ward)}&department=${encodeURIComponent(department)}&workType=${encodeURIComponent(conceptualData.work_type)}&struct_no=${encodeURIComponent(conceptualData.struct_no)}&user_id=${encodeURIComponent(conceptualData.struct_no)}&zone_id=${encodeURIComponent(project.gis_zone_id)}&ward_id=${encodeURIComponent(project.gis_ward_id)}&prabhag_id=${encodeURIComponent(project.gis_prabhag_id)}&edit="true"&editId=${encodeURIComponent(id ? String(id).replace(/"/g, '') : '')}`;

                // Redirect to the new URL with query parameters
                window.location.href = baseURL + queryString;
            }

            // 14) Environment----------------------------------
            else if (department === "Environment") {


                const baseURL = "Environtment.html";

                // Create the query string
                const queryString = `?proj_id=${encodeURIComponent(Work_ID)}&lastInsertedId=${encodeURIComponent(conceptualData.id)}&width=${encodeURIComponent(conceptualData.width)}&length=${encodeURIComponent(conceptualData.length)}&wardName=${encodeURIComponent(conceptualData.ward)}&department=${encodeURIComponent(department)}&workType=${encodeURIComponent(conceptualData.work_type)}&struct_no=${encodeURIComponent(conceptualData.struct_no)}&user_id=${encodeURIComponent(conceptualData.struct_no)}&zone_id=${encodeURIComponent(project.gis_zone_id)}&ward_id=${encodeURIComponent(project.gis_ward_id)}&prabhag_id=${encodeURIComponent(project.gis_prabhag_id)}&edit="true"&editId=${encodeURIComponent(id ? String(id).replace(/"/g, '') : '')}`;

                // Redirect to the new URL with query parameters
                window.location.href = baseURL + queryString;
            }
            // 15) sport---------------------
            else if (department === "Sport") {


                const baseURL = "sport.html";

                // Create the query string
                const queryString = `?proj_id=${encodeURIComponent(Work_ID)}&lastInsertedId=${encodeURIComponent(conceptualData.id)}&width=${encodeURIComponent(conceptualData.width)}&length=${encodeURIComponent(conceptualData.length)}&wardName=${encodeURIComponent(conceptualData.ward)}&department=${encodeURIComponent(department)}&workType=${encodeURIComponent(conceptualData.work_type)}&struct_no=${encodeURIComponent(conceptualData.struct_no)}&user_id=${encodeURIComponent(conceptualData.struct_no)}&zone_id=${encodeURIComponent(project.gis_zone_id)}&ward_id=${encodeURIComponent(project.gis_ward_id)}&prabhag_id=${encodeURIComponent(project.gis_prabhag_id)}&edit="true"&editId=${encodeURIComponent(id ? String(id).replace(/"/g, '') : '')}`;

                // Redirect to the new URL with query parameters
                window.location.href = baseURL + queryString;
            }
            // 16)CEO--------------------------------------
            else if (department === "City Engineer Office") {


                const baseURL = "ceo.html";

                // Create the query string
                const queryString = `?proj_id=${encodeURIComponent(Work_ID)}&lastInsertedId=${encodeURIComponent(conceptualData.id)}&width=${encodeURIComponent(conceptualData.width)}&length=${encodeURIComponent(conceptualData.length)}&wardName=${encodeURIComponent(conceptualData.ward)}&department=${encodeURIComponent(department)}&workType=${encodeURIComponent(conceptualData.work_type)}&struct_no=${encodeURIComponent(conceptualData.struct_no)}&user_id=${encodeURIComponent(conceptualData.struct_no)}&zone_id=${encodeURIComponent(project.gis_zone_id)}&ward_id=${encodeURIComponent(project.gis_ward_id)}&prabhag_id=${encodeURIComponent(project.gis_prabhag_id)}&edit="true"&editId=${encodeURIComponent(id ? String(id).replace(/"/g, '') : '')}`;

                // Redirect to the new URL with query parameters
                window.location.href = baseURL + queryString;
            }

            // 17)slum--------------------------------

            else if (department === 'Slum') {


                const baseURL = "slum.html";

                // Create the query string
                const queryString = `?proj_id=${encodeURIComponent(Work_ID)}&lastInsertedId=${encodeURIComponent(conceptualData.id)}&width=${encodeURIComponent(conceptualData.width)}&length=${encodeURIComponent(conceptualData.length)}&wardName=${encodeURIComponent(conceptualData.ward)}&department=${encodeURIComponent(department)}&workType=${encodeURIComponent(conceptualData.work_type)}&struct_no=${encodeURIComponent(conceptualData.struct_no)}&user_id=${encodeURIComponent(conceptualData.struct_no)}&zone_id=${encodeURIComponent(project.gis_zone_id)}&ward_id=${encodeURIComponent(project.gis_ward_id)}&prabhag_id=${encodeURIComponent(project.gis_prabhag_id)}&edit="true"&editId=${encodeURIComponent(id ? String(id).replace(/"/g, '') : '')}`;

                // Redirect to the new URL with query parameters
                window.location.href = baseURL + queryString;
            }


            //  window.location.href = `road.html?proj_id=${encodeURIComponent(id)}&width=${encodeURIComponent(bufferWidth)}&length=${encodeURIComponent(roadLength)}&wardName=${encodeURIComponent(wardName)}&zone_id=${encodeURIComponent(project.gis_zone_id)}&ward_id=${encodeURIComponent(project.gis_ward_id)}&prabhag_id=${encodeURIComponent(project.gis_prabhag_id)}&edit="true"&editId=` + id.replace(/"/g, '');
        }

        $(document).ready(function () {
            var urlParams = new URLSearchParams(window.location.search);
            var villageName = urlParams.get('Work_ID');
            var filter = "Work_ID = " + villageName;


            console.log(villageName, "work id", filter);
            //    FitbouCustomiseRevenue(filter);

            IWMS_line.setParams({ CQL_FILTER: filter, maxZoom: 19.5, styles: "IWMS_line" }).addTo(map);
            IWMS_polygon.setParams({ CQL_FILTER: filter, maxZoom: 19.5, styles: "IWMS_polygon" }).addTo(map);
            IWMS_point.setParams({ CQL_FILTER: filter, maxZoom: 19.5, styles: "IWMS_points" }).addTo(map);
            Ward_layer.setParams({ CQL_FILTER: filter, maxZoom: 19.5, styles: "GIS_Ward_Layer" }).addTo(map);

            getdata(filter);

            function getdata(filters) {
                const layers = ["pmc:IWMS_line", "pmc:IWMS_polygon", "pmc:IWMS_point", "pmc:GIS_Ward_Layer"];
                const promises = [];
                const layerDetails = ["id", "Work_ID", "Name_of_Work", "Department", "Project_Office", "zone", "ward", "Tender_Amount", "Name_of_JE", "length_1", "width", "area", "geometry"];

                layers.forEach(function (layerName) {
                    const urlm = "https://iwmsgis.pmc.gov.in/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=" +
                        layerName +
                        "&CQL_FILTER=" +
                        filters +
                        "&outputFormat=application/json";

                    $('#table-container').show();

                    const promise = $.getJSON(urlm).then(function (data) {
                        return data.features.map(feature => {
                            const properties = feature.properties;
                            let filteredData = {};
                            layerDetails.forEach(key => {
                                if (properties[key] !== undefined && properties[key] !== null) {
                                    filteredData[key] = properties[key];
                                } else if (feature[key] !== undefined) {
                                    // console.log("hhhhhhhhhhhhh", feature)
                                    filteredData[key] = JSON.stringify(feature[key]);
                                }
                            });
                            filteredData.geometry = feature.geometry;
                            return filteredData;
                        });
                    });

                    promises.push(promise);
                });

                Promise.all(promises).then(function (results) {
                    const flattenedResults = results.flat();
                    paginateResults(flattenedResults);
                }).catch(function (error) {
                    console.error("An error occurred: ", error);
                });
            }

            function paginateResults(data) {
                const itemsPerPage = 1;
                let currentPage = 1;



                function displayPage(page) {
                    console.log(page);
                    const tableBody = document.getElementById('workTableData');
                    tableBody.innerHTML = '';

                    if (data.length === 0) {
                        const emptyMessage = document.createElement('tr');
                        emptyMessage.className = 'empty-message';
                        emptyMessage.innerHTML = '<td colspan="2">No data available.</td>';
                        tableBody.appendChild(emptyMessage);
                        return;
                    }

                    const start = (page - 1) * itemsPerPage;
                    const end = Math.min(start + itemsPerPage, data.length);
                    for (let i = start; i < end; i++) {
                        const item = data[i];
                        for (const [key, value] of Object.entries(item)) {
                            if (key !== "geometry") {
                                const row = document.createElement('tr');
                                const displayValue = key === 'length_1' ? parseFloat(value).toFixed(2) : value;
                                row.innerHTML = `<td>${key}</td><td>${displayValue}</td>`;
                                tableBody.appendChild(row);
                            }
                        }
                    }
                    const editRow = document.createElement('tr');
                    editRow.classList.add('no-bottom-border');
                    const editButtonCell = document.createElement('td');
                    editButtonCell.colSpan = 2;
                    editButtonCell.style.textAlign = 'center';
                    const department = data[page - 1].Department.replace(/'/g, "\\'").replace(/"/g, '&quot;');
                    const id = data[page - 1].id
                    //.replace(/'/g, "\\'").replace(/"/g, '&quot;');
                    console.log(data[page - 1]);
                    const Work_ID = data[page - 1].Work_ID;


                    // editButtonCell.innerHTML = `<button type="button" onclick="onClickEdit('${department}', '${id}','${Work_ID}')" class="edit-button"><i class="fas fa-pen"></i>&nbsp;Edit</button>`;




                    // Create the button element
                    const button = document.createElement('button');
                    button.type = 'button';
                    button.className = 'edit-button';
                    button.innerHTML = `<i class="fas fa-pen"></i>&nbsp;Edit`;

                    // Attach the click event listener
                    button.addEventListener('click', function () {
                        onClickEdit(department, id, Work_ID);
                    });

                    // Append the button to the editButtonCell
                    editButtonCell.appendChild(button);







                    editRow.appendChild(editButtonCell);
                    tableBody.appendChild(editRow);

                    const paginationControls = document.getElementById('pagination-controls');
                    paginationControls.innerHTML = '';
                    highlightFeature(data[start].geometry);
                    updatePagination(page);

                }

                function updatePagination(page) {
                    const paginationControls = document.getElementById('pagination-controls');
                    paginationControls.innerHTML = '';

                    const totalPages = Math.ceil(data.length / itemsPerPage);

                    const prevButton = document.createElement('button');

                    prevButton.innerHTML = '<';

                    prevButton.classList.add('arrow');
                    prevButton.disabled = page === 1;
                    prevButton.addEventListener('click', () => {
                        if (page > 1) {
                            displayPage(page - 1);
                        }
                    });
                    paginationControls.appendChild(prevButton);

                    const maxVisiblePages = 5;
                    let startPage = Math.max(1, page - Math.floor(maxVisiblePages / 2));
                    let endPage = startPage + maxVisiblePages - 1;
                    if (endPage > totalPages) {
                        endPage = totalPages;
                        startPage = Math.max(1, endPage - maxVisiblePages + 1);
                    }



                    for (let i = startPage; i <= endPage; i++) {
                        const button = document.createElement('button');
                        button.textContent = i;
                        button.classList.add('page-num');
                        if (i === page) {
                            button.style.fontWeight = 'bold';
                        }
                        button.addEventListener('click', () => {
                            displayPage(i);
                        });
                        paginationControls.appendChild(button);
                    }



                    const nextButton = document.createElement('button');
                    nextButton.innerHTML = '>';

                    nextButton.classList.add('arrow');
                    nextButton.disabled = page === totalPages;
                    nextButton.addEventListener('click', () => {
                        if (page < totalPages) {
                            displayPage(page + 1);
                        }
                    });
                    paginationControls.appendChild(nextButton);
                }

                function highlightFeature(geometry) {
                    if (highlightLayer) {
                        map.removeLayer(highlightLayer);
                    }
                    highlightLayer = L.geoJSON(geometry, {
                        styles: {
                            color: '#0000FF',
                            weight: 5,
                            opacity: 0.65
                        }
                    }).addTo(map);
                    map.fitBounds(highlightLayer.getBounds());
                }

                // Display initial page
                displayPage(currentPage);
            }

            function FitbouCustomiseRevenue(filter) {
                const layers = ["pmc:IWMS_line", "pmc:IWMS_polygon", "pmc:IWMS_point", "pmc:GIS_Ward_Layer"];
                let bounds = L.latLngBounds();
                let pendingRequests = layers.length;

                layers.forEach(function (layerName) {
                    const urlm = geoserverUrl + "/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=" +
                        layerName +
                        "&CQL_FILTER=" +
                        filter +
                        "&outputFormat=application/json";

                    $.getJSON(urlm, function (data) {
                        const geojson = L.geoJson(data, {});
                        if (geojson && geojson.getBounds && geojson.getBounds().isValid()) {
                            bounds.extend(geojson.getBounds());
                        }

                        pendingRequests--;
                        if (pendingRequests === 0 && bounds.isValid()) {
                            map.fitBounds(bounds);
                        }
                    });
                });
            }

            //             document.addEventListener("DOMContentLoaded", function() {
            //             function printPage() {
            //                 window.print();
            //             }

            //             document.getElementById("generatePdfBtn").onclick = printPage;
            //         });



        });
        $(document).ready(function () {
            // Your existing document ready code...

            function printPage() {
                window.print();
            }

            // Move the onclick assignment inside the document ready block
            document.getElementById("generatePdfBtn").onclick = printPage;
        });
    </script>
</body>

</html>