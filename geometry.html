<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PMC</title>
    <link rel="icon" href="png/pmcjpeg.png" type="image/x-icon" />

    <!-- External CSS -->
    <link rel="stylesheet" href="css/geom.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/boxicons@latest/css/boxicons.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.7/css/dataTables.bootstrap5.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-draw/dist/leaflet.draw.css" />
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" />

    <!-- External JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-ajax/dist/leaflet.ajax.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.7/js/dataTables.bootstrap5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.0/jspdf.umd.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script src="https://unpkg.com/leaflet-draw/dist/leaflet.draw.js"></script>

<style>

    
#deleteFeatureButton {
      border: 2px solid #2b13bb;
      border-top: 2px solid #2b13bb;
      border-radius: 5px 5px 5px 5px;
      background-color: white;
      color: black;
      padding: 3px 7px;
      display: none;
      position: fixed;
      top: 92%;
      /* changed from 683px */
      font-size: 15px;
      height: 37px;
      width: 37px;
      left: 60%;
      /* changed from 908px */
    }

    #editFeatureButton {
      border: 2px solid #2b13bb;
      border-radius: 5px 5px 5px 5px;
      height: 37px;
      width: 37px;
      display: none;
      position: fixed;
      top: 92%;
      /* changed from 683px */
      left: 56%;
      /* changed from 822px */
      padding: 5px;
      background: white;
      border-bottom: 2px solid #2b13bb;
    }

</style>


</head>
<body class="bg-light">
    <img src="png/pmcjpeg.png" alt="" class="logopng1" />
    <div id="content" style="width: 100%" class="container">
        <div id="button-container" class=""></div>

        <section id="map-section" class="">
            <form class="mt-3" style="overflow: hidden">
                <div style="margin: 0; float: left">
                    <h5 class="text-secondary">Preview Map</h5>
                </div>
                <div style="float: right; margin-top: -40px; margin-left: 95%">
                    <i class="fa-solid fa-print text-primary" id="generatePdfBtn" onclick="printPage()" style="font-size: 25px"></i>
                </div>
                <div id="map"></div>
                <a class="geopulseaname" style="color: darkblue; position: absolute; z-index: 99999; bottom: 0.5%; right: 0; font-weight: bold; font-size: 10px;">@GeoPulse Analytics</a>
                <div id="table-container">
                    <table id="workTable" class="table table-bordered table-hover" style="width: 100% !important; font-size: 10px">
                        <thead>
                            <tr>
                                <th>Attribute</th>
                                <th>Value</th>
                            </tr>
                        </thead>
                        <tbody id="workTableData"></tbody>
                    </table>
                    <div id="pagination-controls" class="pagination">
					
					</div>
					
                </div>
            </form>
        </section>
    </div>

    <script>
        var map = L.map("map", {
            center: [18.52, 73.89],
            zoom: 8,
            minZoom: 9,
            maxZoom: 16,
            boxZoom: true,
            trackResize: true,
            wheelPxPerZoomLevel: 40,
            zoomAnimation: true,
            dragging: true,
            zoomControl: false,
            scrollWheelZoom: true,
            doubleClickZoom: false,
            touchZoom: false
        });

        var googleSat = L.tileLayer("http://{s}.google.com/vt/lyrs=s&x={x}&y={y}&z={z}", {
            maxZoom: 20,
            subdomains: ["mt0", "mt1", "mt2", "mt3"]
        });

        var Esri_WorldImagery = L.tileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}", {
            maxZoom: 20
        });

        var osm = L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
            maxZoom: 19
        }).addTo(map);

        var IWMS_line = L.tileLayer.wms("https://iwmsgis.pmc.gov.in//geoserver/pmc/wms", {
            layers: "IWMS_line",
            format: "image/png",
            transparent: true,
            tiled: true,
            version: "1.1.0",
            opacity: 1
        });

        var IWMS_polygon = L.tileLayer.wms("https://iwmsgis.pmc.gov.in//geoserver/pmc/wms", {
            layers: "IWMS_polygon",
            format: "image/png",
            transparent: true,
            tiled: true,
            version: "1.1.0",
            opacity: 1
        });

        var IWMS_point = L.tileLayer.wms("https://iwmsgis.pmc.gov.in//geoserver/pmc/wms", {
            layers: "IWMS_point",
            format: "image/png",
            transparent: true,
            tiled: true,
            version: "1.1.0",
            opacity: 1
        });

        var WMSlayers = {
            "Esri": Esri_WorldImagery,
            "Satellite": googleSat,
            "osm": osm,
            "IWMS_line": IWMS_line,
            "IWMS_polygon": IWMS_polygon,
            "IWMS_point": IWMS_point
        };

        var control = new L.control.layers({}, WMSlayers).addTo(map);
        control.setPosition('topright');

        var highlightLayer;

        $(document).ready(function () {
            var urlParams = new URLSearchParams(window.location.search);
            var villageName = urlParams.get('Work_ID');
            var filter = "Work_ID = " + villageName;

            console.log(villageName, "work id", filter);
            FitbouCustomiseRevenue(filter);

            IWMS_line.setParams({ CQL_FILTER: filter, maxZoom: 19.5, styles: "IWMS_line" }).addTo(map);
            IWMS_polygon.setParams({ CQL_FILTER: filter, maxZoom: 19.5, styles: "IWMS_polygon" }).addTo(map);
            IWMS_point.setParams({ CQL_FILTER: filter, maxZoom: 19.5, styles: "IWMS_points" }).addTo(map);

            getdata(filter);


			

            function getdata(filters) {
                const layers = ["pmc:IWMS_line", "pmc:IWMS_polygon", "pmc:IWMS_point"];
                const promises = [];
                const layerDetails = ["id", "Work_ID", "Name_of_Work", "Department", "Work_Type", "Project_Office", "zone_id", "zone", "ward", "Tender_Amount", "Name_of_JE", "Contact_Number", "length_1", "width", "area", "geometry"];

                layers.forEach(function (layerName) {
                    const urlm = "https://iwmsgis.pmc.gov.in//geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=" +
                        layerName +
                        "&CQL_FILTER=" +
                        filters +
                        "&outputFormat=application/json";

                    $('#table-container').show();

                    const promise = $.getJSON(urlm).then(function (data) {
                        return data.features.map(feature => {
                            const properties = feature.properties;
                            let filteredData = {};
                            layerDetails.forEach(key => {
                                if (properties[key] !== undefined && properties[key] !== null) {
                                    filteredData[key] = properties[key];
                                }else  if (feature[key] !== undefined){
									console.log("hhhhhhhhhhhhh",feature)
									filteredData[key] = JSON.stringify(feature[key]);
								}
                            });
                            filteredData.geometry = feature.geometry;
                            return filteredData;
                        });
                    });

                    promises.push(promise);
                });

                Promise.all(promises).then(function (results) {
                    const flattenedResults = results.flat();
                    paginateResults(flattenedResults);
                }).catch(function (error) {
                    console.error("An error occurred: ", error);
                });
            }

            function paginateResults(data) {
                const itemsPerPage = 1;
                let currentPage = 1;
				console.log(data,"daraar")

                function displayPage(page) {
                    const tableBody = document.getElementById('workTableData');
                    tableBody.innerHTML = '';


                    if (data.length === 0) {
                        const emptyMessage = document.createElement('tr');
                        emptyMessage.className = 'empty-message';
                        emptyMessage.innerHTML = '<td colspan="2">No data available.</td>';
                        tableBody.appendChild(emptyMessage);
                        return;
                    }

                    const start = (page - 1) * itemsPerPage;
                    const item = data[start];

                    for (const [key, value] of Object.entries(item)) {
                        if (key !== "geometry") {
                            const row = document.createElement('tr');
                            row.innerHTML = `<td>${key}</td><td>${value}</td>`;
                            tableBody.appendChild(row);
                        }
                    }

					const paginationControlss = document.getElementById('pagination-controls');
                    paginationControlss.innerHTML = '';

                    highlightFeature(item.geometry);
                    updatePagination(page);
                }

                function updatePagination(page) {
                    const paginationControls = document.getElementById('pagination-controls');
                    paginationControls.innerHTML = '';

                    const totalPages = Math.ceil(data.length / itemsPerPage);
					// let button1 = document.createElement('button');
					// button1.textContent = "Zoom All";
					// paginationControls.appendChild(button1);
					// button1.addEventListener('click', () => {
                    //         alert("heelo")
							
                    //     });

                    for (let i = 1; i <= totalPages; i++) {
                        const button = document.createElement('button');
                        button.textContent = i;
                        if (i === page) {
                            button.style.fontWeight = 'bold';
                        }
                        button.addEventListener('click', () => {
                            currentPage = i;
                            displayPage(i);
                        });
                        paginationControls.appendChild(button);
                    }
					
                }

                function highlightFeature(geometry) {
                    if (highlightLayer) {
                        map.removeLayer(highlightLayer);
                    }
                    highlightLayer = L.geoJSON(geometry, {
                        style: {
                            color: '#0000FF',
                            weight: 5,
                            opacity: 0.65
                        }
                    }).addTo(map);
                    // map.fitBounds(highlightLayer.getBounds());
                }
				function zoomAllFeatures(data) {
                if (highlightLayer) {
                    map.removeLayer(highlightLayer);
                }

                highlightLayer = L.geoJSON(data.map(item => item.geometry), {
                    style: {
                        color: '#ff7800',
                        weight: 5,
                        opacity: 0.65
                    }
                }).addTo(map);
                map.fitBounds(highlightLayer.getBounds());
            }

                displayPage(currentPage);
            }
        });

        function FitbouCustomiseRevenue(filter) {
            const layers = ["pmc:IWMS_line", "pmc:IWMS_polygon", "pmc:IWMS_point"];
            let bounds = L.latLngBounds();
            let pendingRequests = layers.length;

            layers.forEach(function (layerName) {
                const urlm = "https://iwmsgis.pmc.gov.in//geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=" +
                    layerName +
                    "&CQL_FILTER=" +
                    filter +
                    "&outputFormat=application/json";

                $.getJSON(urlm, function (data) {
                    const geojson = L.geoJson(data, {});
                    if (geojson && geojson.getBounds && geojson.getBounds().isValid()) {
                        bounds.extend(geojson.getBounds());
                    }

                    pendingRequests--;
                    if (pendingRequests === 0 && bounds.isValid()) {
                        map.fitBounds(bounds);
                    }
                });
            });
        }

        function printPage() {
            window.print();
        }

//edit feautere 


var editControl = L.control({ position: 'topleft' });
var customSaveEditButton = L.control({ position: 'topleft' });
customSaveEditButton.onAdd = function (map) {
  var div = L.DomUtil.create('div', 'saveDataButton');
  div.innerHTML = '<button id="saveDataButton" type="button"  title="Save Feature"> <i class="fa-regular fa-floppy-disk"></i></button>';
  customDrawControlsContainer = div;
  return div;
};


customSaveEditButton.addTo(map);



var customEditLayerButton = L.control({ position: 'topleft' });

customEditLayerButton.onAdd = function (map) {
  var div = L.DomUtil.create('div', 'editFeatureButton');
  div.innerHTML = '<img id="editFeatureButton"  title=" Edit Feature" src="png/editTool.png" >';
  customDrawControlsContainer = div;
  return div;
};


customEditLayerButton.addTo(map);


var customDeleteLayerButton = L.control({ position: 'topleft' });

customDeleteLayerButton.onAdd = function (map) {
  var div = L.DomUtil.create('div', 'deleteFeatureButton');
  div.innerHTML = '<button id="deleteFeatureButton"  title="Delete Feature"> <i class="fa-solid fa-trash-can"></i></button>';
  customDrawControlsContainer = div;
  return div;
};


customDeleteLayerButton.addTo(map);


var editableLayers = new L.FeatureGroup().addTo(map);
    var selectedFeature = null;



    function performTask() {


      map.on("click", function (e) {
        let size = map.getSize();
        let bbox = map.getBounds().toBBoxString();
        let layer = "pmc:Exist_Road";

        if (department == 'Road') {
          layer = "pmc:Exist_Road";

        }
        else if (department == 'Building') {
          layer = "pmc:Reservations";

        }
        else if (department == 'Drainage') {
          layer = "pmc:storm_water";

        }

        var url = `https://iwmsgis.pmc.gov.in//geoserver/pmc/wms?SERVICE=WMS&VERSION=1.1.1&REQUEST=GetFeatureInfo&FORMAT=image%2Fpng&TRANSPARENT=true&QUERY_LAYERS=${layer}&STYLES&LAYERS=${layer}&exceptions=application%2Fvnd.ogc.se_inimage&INFO_FORMAT=application/json&FEATURE_COUNT=50&X=${Math.round(
          e.containerPoint.x
        )}&Y=${Math.round(e.containerPoint.y)}&SRS=EPSG%3A4326&WIDTH=${size.x
          }&HEIGHT=${size.y}&BBOX=${bbox}`;





        fetch(url)
          .then((response) => response.json())
          .then((data) => {

            highlightFeature(data);
          });
      });

      function highlightFeature(featureData) {
        // Check if any features are present in the featureData
        if (
          !featureData ||
          !featureData.features ||
          featureData.features.length === 0
        )

          // Clear existing editable layers
          editableLayers.clearLayers();

        // Get the first feature from the featureData
        var feature = featureData.features[0];

        var geojsonLayer = L.geoJSON(feature, {
          style: {
            color: "red",
            weight: 3,
            opacity: 1,
            fillOpacity: 0.5,
          },
        });

        editableLayers.addLayer(geojsonLayer);

        if (editableLayers.getLayers().length > 0) {

          map.fitBounds(editableLayers.getBounds());
        }
      }

      editableLayers.on("contextmenu", function (e) {
        // Check if there is a selected feature

        toggleSelectLayerButton(true);


        if (editableLayers.getLayers().length > 0) {
          selectedFeature = editableLayers.getLayers()[1];

          // Get the coordinates of the right-clicked point
          var latlng = e.latlng;
          var popupContent = "<h5>Selected Feature</h5>";

          if (localStorage.getItem("conceptual_form_data_temp")) {
            const formDataFromStorage = JSON.parse(
              localStorage.getItem("conceptual_form_data_temp")
            );



            $('#table-container').show();
            console.log(formDataFromStorage);
            let contentData = '<tr>';
            for (const property in formDataFromStorage) {
              contentData += `<tr><th>${property}</th><td>${formDataFromStorage[property]}</td></tr>`;
            }
            contentData += '</tr>';
            $('#workTableData').html(contentData);


          }
          document.getElementById("saveDataButton").addEventListener("click", function () {
              var featureData = selectedFeature.toGeoJSON();

              var featureId = featureData.features[0].id;
              let formDataFromStorage;
              let formDataTemp = localStorage.getItem(
                "conceptual_form_data_temp"
              );
              if (formDataTemp) {
                localStorage.setItem("conceptual_form_data", formDataTemp);
                formDataFromStorage = JSON.parse(formDataTemp);
              }

              var roadLength =
                formDataFromStorage &&
                  formDataFromStorage.hasOwnProperty("Length")
                  ? formDataFromStorage.Length
                  : 10;

              var bufferWidth =
                formDataFromStorage &&
                  formDataFromStorage.hasOwnProperty("Width")
                  ? formDataFromStorage.Width
                  : 20;



              let selectCoordinatesData = featureData.features;

              var lenghtSelect = turf.length(selectCoordinatesData[0].geometry, { units: 'meters' });

              console.log(lenghtSelect);

              localStorage.setItem(
                "selectCoordinatesData",
                JSON.stringify(selectCoordinatesData)
              );

              var lastInsertedId = localStorage.getItem("lastInsertedId");


              var payload = JSON.stringify({
                geoJSON: JSON.stringify(featureData),
                roadLength: lenghtSelect,
                bufferWidth: bufferWidth,
                gis_id: lastInsertedId,
                department: department,
                selectCoordinatesData: selectCoordinatesData,
              });

              $.ajax({
                type: "POST",
                url: "APIS/gis_update.php",
                data: payload,
                contentType: "application/json",
                success: function (response) {
                  Swal.fire({
                    position: "center",
                    icon: "success",
                    title: "Success",
                    text: "Saved Successfully",
                    showConfirmButton: false,
                    showCloseButton: true,
                    customClass: {
                      popup: "custom-modal-class",
                      icon: "custom-icon-class",
                      title: "custom-title-class",
                      content: "custom-text-class",
                      closeButton: "custom-close-button-class",
                    },
                    showClass: {
                      popup: "swal2-show",
                      backdrop: "swal2-backdrop-show",
                      icon: "swal2-icon-show",
                    },
                    hideClass: {
                      popup: "swal2-hide",
                      backdrop: "swal2-backdrop-hide",
                      icon: "swal2-icon-hide",
                    },
                    didOpen: () => {
                      // Apply custom styles directly to the modal elements
                      document.querySelector(".custom-modal-class").style.width = "400px"; // Set your desired width
                      document.querySelector(".custom-modal-class").style.height = "250px"; // Set your desired height
                      document.querySelector(".custom-modal-class").style.transition = "all 0.5s ease";
                      document.querySelector(".custom-icon-class").style.fontSize = "10px"; // Set your desired icon size
                      document.querySelector(".custom-icon-class").style.transition = "all o.5s ease";
                      document.querySelector(".custom-title-class").style.fontSize =
                        "1.5em"; // Set your desired title size
                      document.querySelector(".custom-text-class").style.fontSize = "1em"; // Set your desired text size
                      document.querySelector(
                        ".custom-close-button-class"
                      ).style.backgroundColor = "#f44336"; // Red background color
                      document.querySelector(".custom-close-button-class").style.color =
                        "white"; // White text color
                      document.querySelector(
                        ".custom-close-button-class"
                      ).style.borderRadius = "0"; // Rounded corners
                      document.querySelector(".custom-close-button-class").style.padding =
                        "5px"; // Padding around the close button
                      document.querySelector(".custom-close-button-class").style.fontSize =
                        "20px"; // Font size of the close button
                    },
                  });

                  setTimeout(() => {
                    //  window.location.href = `geometry_page.html?id=`+response.lastInsertIdIWMS+`&department=Road`+`&lastInsertedId=`+lastInsertedId;
                  }, 2100);
                },
                error: function (xhr, status, error) {
                  console.error("Save failed:", error);
                },
              });
             
              area = turf.length(selectCoordinatesData[0].geometry, { units: 'meters' }); 
          console.log(selectCoordinatesData)
            var formData = new FormData();
            formData.append('proj_id', worksAaApprovalId);
            formData.append('latitude', selectCoordinatesData[0].geometry.coordinates[0][1]);
            formData.append('longitude', selectCoordinatesData[0].geometry.coordinates[0][0]);
            formData.append('polygon_area', 0);
            formData.append('polygon_centroid', 0);
            formData.append('geometry', JSON.stringify(selectCoordinatesData[0].geometry.coordinates?.map(coordinates => coordinates.slice().reverse())));
            formData.append('road_no', struct_no);
            formData.append('user_id', user_id);
            formData.append('length', lenghtSelect);
            formData.append('width', width);
          
                      $.ajax({
                type: "POST",
                url: "https://iwms.punecorporation.org/api/gis-data",
                data: formData,
                processData: false,
                contentType: false,
                success: function (response) {
                  console.log(response);
                  window.location.href = response.data.redirect_Url;
                },
                error: function (xhr, status, error) {
                  console.error("Save failed:", error);
                },
              });

            });

        }
      });


      // Change the button text to "Finish"
      var button = document.querySelector('.custom-button');
      button.innerHTML = 'Finish';

      // Change the button's onclick function to stop the task
      button.onclick = function () {
        button.innerHTML = '<img src="png/003-selection.png" alt="" style="width:20px;  height:20px padding:5px; " title="SELECT-FEATURE">';
        // Remove the click event listener from the map
        var drawFeatureButton = document.querySelector('.draw_feature');
        if (drawFeatureButton) {
          drawFeatureButton.removeAttribute('disabled');
        }

        map.off("click");
        toggleSelectLayerButton(false);
        // Reset any ongoing operation here
      };
    }

    function updatePopup(layer) {
  let content;
  var coordinates = layer._latlngs[0];
  var turfCoords = coordinates.map(function (coord) {
    return [coord.lng, coord.lat];
  });

  if (layer instanceof L.Polyline) {
    var line = turf.lineString(turfCoords);
    var length = turf.length(line, { units: 'meters' });
    content = length.toFixed(2) + " M"; // Fixed length to 2 decimal places
  } else if (layer instanceof L.Polygon) {
    var polygon = turf.polygon([turfCoords]);
    var area = turf.area(polygon);
    content = area.toFixed(2) + " SQM"; // Fixed area to 2 decimal places
  }

  if (!layer._popup) {
    layer.bindPopup(content);
  } else {
    layer.setPopupContent(content);
  }
  layer.openPopup();
}


document.getElementById("editFeatureButton").addEventListener("click", function (event) {
    event.preventDefault();
    event.stopPropagation();
    selectedFeature.eachLayer(function (layer) {
        if (layer.editing) {
            layer.editing.enable();
            layer.on('edit', function () {
                updatePopup(layer);
            });
        } else {
            layer.on("click", function () {
                if (this.editing) {
                    this.editing.enable();
                    updatePopup(this);
                    this.on('edit', function () {
                        updatePopup(this);
                    });
                }
            });
        }
    });
});

    document.getElementById('deleteFeatureButton').addEventListener('click', function () {
      if (!selectedFeature) {
        alert('No feature selected!');
        return;
      }

      editableLayers.removeLayer(selectedFeature);
      selectedFeature = null;
    });

    function updatePopup(layer) {
      let content;
      var coordinates = layer._latlngs[0]
      var turfCoords = coordinates.map(function (coord) {
        return [coord.lng, coord.lat];
      });

      if (layer instanceof L.Polyline) {
        var line = turf.lineString(turfCoords);
        var length = turf.length(line, { units: 'meters' });
        content = length + "M"
      } else if (layer instanceof L.Polygon) {
        var polygon = turf.polygon([turfCoords]);   
        var area = turf.area(polygon);
        content = length + "SQM"
      }

      if (!layer._popup) {
        layer.bindPopup(content);
      } else {
        layer.setPopupContent(content);
      }
      layer.openPopup();
    }

    // ----------------------



    editControl.onAdd = function (map) {
      var button = L.DomUtil.create('button', 'custom-button');
      button.innerHTML = '<img src="png/003-selection.png" alt="" style="width:20px; height:20px;" title="SELECT FEATURE">';
      button.onclick = function () {
        var drawFeatureButton = document.querySelector('.draw_feature');
        if (button.innerHTML === '<img src="png/003-selection.png" alt="" style="width:20px; height:20px; " title="SELECT FEATURE">') {
          button.innerHTML = 'Finish';
          performTask();

          // Remove the draw control if it's currently added
    

    
        } else {
          button.innerHTML = '<img src="png/003-selection.png" alt="" style="width:20px; height:20px; " title="SELECT FEATURE">';
          // Finish or reset any ongoing operation here
          if (drawFeatureButton) {
            drawFeatureButton.setAttribute('disabled', false);
          }

          // button.innerHTML = 'Select Feature';
          // Add the draw control back if it's not currently added
 
          // Show the custom draw controls button
          if (drawFeatureButton) {
            drawFeatureButton.setAttribute('disabled', false);
          }
        }
      };
      return button;
    }; 
     
    



    // Add the control to the map

    editControl.addTo(map);





    </script>
</body>
</html>
