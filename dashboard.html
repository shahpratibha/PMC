<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PMC</title>
    <link rel="stylesheet" href="style.css" />
    <!-- bootstrap -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdn.datatables.net/1.13.7/css/dataTables.bootstrap5.min.css"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
      crossorigin="anonymous"
    ></script>

    <!-- fontawsome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
      integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/js/all.min.js"
      integrity="sha512-GWzVrcGlo0TxTRvz9ttioyYJ+Wwk9Ck0G81D+eO63BaqHaJ3YZX9wuqjwgfcV/MrB2PhaVX9DkYVhbFpStnqpQ=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <!-- leaflet -->
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
      integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
      crossorigin=""
    />

    <!-- leaflet -->
    <script
      src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
      integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
      crossorigin=""
    ></script>

    <!-- to geojson -->
    <script src="https://unpkg.com/togeojson@1.1.0/togeojson.js"></script>

    <!-- leaflet-ajax -->
    <script src="https://unpkg.com/leaflet-ajax/dist/leaflet.ajax.min.js"></script>

    <!-- fontawsome -->
    <link
      rel="stylesheet"
      href="https://pro.fontawesome.com/releases/v5.10.0/css/all.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
      integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>

    <!-- Leflet for adding draw tool start-->
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

    <!-- Leaflet JavaScript -->
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

    <!-- Leaflet.draw CSS -->
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet-draw/dist/leaflet.draw.css"
    />

    <!-- Leaflet.draw JavaScript -->
    <script src="https://unpkg.com/leaflet-draw/dist/leaflet.draw.js"></script>

    <!-- Include jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

    <!-- Leflet for adding draw tool END -->

    <script src="https://unpkg.com/@turf/turf@6.3.0/turf.min.js"></script>

    <script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.7/js/dataTables.bootstrap5.min.js"></script>

    <!-- html2pdfcdn -->
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"
      integrity="sha512-GsLlZN/3F2ErC5ifS5QtgpiJtWd43JWSuIgh7mbzZ8zBps+dvLusV+eNQATqgA/HdeKFVgA5v3S/cIrLF7QnIg=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>

    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.0/jspdf.umd.min.js"></script> -->

    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.3.1/jspdf.umd.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
    <link
      rel="stylesheet"
      href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <style>
      .multi-checkboxes_wrap:before {
        font-family: fontAwesome;
        color: #999;
        content: "\f096";
        width: 25px;
        height: 25px;
        padding-right: 10px;
      }
      .multi-checkboxes_wrap[aria-selected="true"]:before {
        content: "\f14a";
      }
      .form-group label {
        font-size: 12px;
        font-weight: 600;
        margin-left: 0px;
      }
    </style>
  </head>
  <body>
    <div class="container-fluid">
      <header class="bg-secondary">
        <nav class="navbar navbar-expand-lg bg-body-tertiary">
          <div class="container-fluid">
            <a class="navbar-brand" href="#">Geopulse</a>
            <button
              class="navbar-toggler"
              type="button"
              data-bs-toggle="collapse"
              data-bs-target="#navbarSupportedContent"
              aria-controls="navbarSupportedContent"
              aria-expanded="false"
              aria-label="Toggle navigation"
            >
              <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
              <ul class="navbar-nav me-auto mb-2 mb-lg-0"></ul>
              <form class="d-flex" role="search">
                <input
                  class="form-control me-2"
                  type="search"
                  placeholder="Search"
                  aria-label="Search"
                  id="searchInput"
                />
                <div
                  id="autocompleteSuggestions"
                  class="autocomplete-suggestions"
                ></div>

                <button class="btn btn-outline-success" type="submit">
                  Clear
                </button>
              </form>
              <button id="showTableBtn" class="btn btn-outline-secondary ms-2">
                <i class="fa fa-map"></i>
              </button>
            </div>
          </div>
        </nav>
      </header>

      <div class="row">
        <!-- Left Sidebar -->
        <div class="col-md-2" style="background-color: #bbb;">
          <div class="form-group mt-5">
            <label>Select Year</label>
            <select class="select2 form-control"  multiple="multiple">
              <option class="select2 form-control value="">2022-2023</option>
              <option class="select2 form-control value="">2023-2024</option>
              <option class="select2 form-control value="">2024-2025</option>


            </select>
           
          </div>
          <div class="form-group mt-5">
            <label>Layers Name (Amount)</label>
            <select class="select2 form-control" multiple="multiple"></select>
          </div>
          <div class="form-group mt-5">
            <label for="admin_ward_name">Layers Name (Admin Ward Name)</label>
            <select
              class="select2 form-control"
              multiple="multiple"
              id="admin_ward_name"
            ></select>
          </div>
          <div class="form-group mt-5">
            <label>Layers Name (Zone Name)</label>
            <select
              class="form-control"
              multiple="multiple"
              id="zones"
            ></select>
          </div>
          <div class="form-group mt-5">
            <label>Layers Name (Village Name)</label>
            <select
              class="form-control"
              multiple="multiple"
              id="villages"
            ></select>
          </div>
        </div>

        <!-- Main Content -->
        <div class="col-md-8">
          <main>
            <div id="map"></div>
          </main>
        </div>

        <!-- Right Sidebar -->
        <div class="col-md-2" style="background-color: #bbb;">
          <div class="form-group mt-4">
            <label>Amount</label>
            <select class="select2 form-control" multiple="multiple"></select>
          </div>
          <div class="form-group mt-4">
            <label>Dates</label>
            <select class="select2 form-control" multiple="multiple"></select>
          </div>
          <div class="form-group mt-4">
            <label for="admin_ward_name">Departments</label>
            <select
              class="form-control"
              id="departments"
              multiple="multiple"
            ></select>
          </div>
          <div class="form-group mt-4">
            <label>Layers Name (Project Status)</label>
            <select class="select2 form-control" multiple="multiple"></select>
          </div>
          <div class="form-group mt-4">
            <label>Layers Name (Work Type)</label>
            <select class="select2 form-control" multiple="multiple"></select>
          </div>
          <div class="form-group mt-4">
            <label>Select With Radius</label>
            <select class="select2 form-control" multiple="multiple"></select>
          </div>
          <div class="form-group mt-4">
            <label>Catchment Area</label>
            <select class="select2 form-control" multiple="multiple"></select>
          </div>
        </div>
      </div>

      <div id="table-container">
        <button id="closeTableBtn" class="close-button">
          <i class="fas fa-times"></i>
        </button>

        <table
          id="workTable"
          class="table table-bordered table-hover"
          style="width: 100% !important"
        >
          <thead>
            <tr>
              <th>Name of Work</th>
              <th>Work Type</th>
              <th>Work Completion Date</th>
              <th>Zone</th>
              <th>Ward</th>
              <th>Prabhag</th>
            </tr>
          </thead>
          <tfoot>
            <tr>
              <th>Name of Work</th>
              <th>Work Type</th>
              <th>Work Completion Date</th>
              <th>Zone</th>
              <th>Ward</th>
              <th>Prabhag</th>
            </tr>
          </tfoot>
          <tbody></tbody>
        </table>
      </div>
    </div>
    <script src="index.js"></script>
    <script src="select2.js"></script>
    <script>
      $(document).ready(function () {
        loadAdminWardName();
        loadZones();
        loadVillages();
        loadDepartments();
      });
      function loadAdminWardName() {
        $.getJSON("APIS/PMC_Admin_Ward.php", function (data) {
          var select = $("#admin_ward_name");

          select.empty();

          $.each(data, function (index, item) {
            select.append(
              $("<option>", {
                value: item.fid,
                text: item.Ward_Office,
                "data-coordinates": item.geom, // Assuming coordinates are available in the API response
              })
            );
          });

          // Trigger change event when the select box is loaded
          select.trigger("change");

          // Initialize Select2 with checkboxes and multiple mode
          select.select2({
            templateResult: function (option) {
              if (!option.id) {
                return option.text;
              }

              var $option = $(
                '<span class="select2-option"><input type="checkbox" class="select2-option-checkbox" />' +
                  option.text +
                  "</span>"
              );
              return $option;
            },
            templateSelection: function (option) {
              if (!option.id) {
                return option.text;
              }

              return $(
                '<span class="select2-option"><input type="checkbox" class="select2-option-checkbox" checked />' +
                  option.text +
                  "</span>"
              );
            },
            closeOnSelect: false,
            dropdownParent: select.parent(),
            multiple: true,
          });

          // Event listener for change event
          select.on("change", function () {
            var selectedOptions = $(this).find(":selected");
            var selectedCoordinates = [];

            selectedOptions.each(function () {
              selectedCoordinates.push($(this).data("coordinates"));
            });

            // Use the selected coordinates to draw on the map
            console.log("Selected coordinates:", selectedCoordinates);

            drawCoordinatesOnMap(selectedCoordinates);
          });
        });
      }

      function loadZones() {
        $.getJSON("APIS/Zone_layer.php", function (data) {
          var select = $("#zones");

          select.empty();

          $.each(data, function (index, item) {
            select.append(
              $("<option>", {
                value: item.fid,
                text: item.Zone_Name,
                "data-coordinates": item.geom,
              })
            );
          });

          // Trigger change event when the select box is loaded
          select.trigger("change");
          select.select2({
            templateResult: function (option) {
              if (!option.id) {
                return option.text;
              }

              var $option = $(
                '<span class="select2-option"><input type="checkbox" class="select2-option-checkbox" />' +
                  option.text +
                  "</span>"
              );
              return $option;
            },
            templateSelection: function (option) {
              if (!option.id) {
                return option.text;
              }

              return $(
                '<span class="select2-option"><input type="checkbox" class="select2-option-checkbox" checked />' +
                  option.text +
                  "</span>"
              );
            },
            closeOnSelect: false,
            dropdownParent: select.parent(),
            multiple: true,
          });

          // Event listener for change event
          select.on("change", function () {
            var selectedOptions = $(this).find(":selected");
            var selectedCoordinates = [];

            selectedOptions.each(function () {
              selectedCoordinates.push($(this).data("coordinates"));
            });

            // Use the selected coordinates to draw on the map
            console.log("Selected coordinates:", selectedCoordinates);

            drawCoordinatesOnMap(selectedCoordinates);
          });
        });
      }

      function loadVillages() {
        $.getJSON("APIS/Village_Boundary.php", function (data) {
          var select = $("#villages");

          select.empty();

          $.each(data, function (index, item) {
            select.append(
              $("<option>", {
                value: item.fid,
                text: item.Village_Name,
                "data-coordinates": item.geom,
              })
            );
          });

          // Trigger change event when the select box is loaded
          select.trigger("change");
          select.select2({
            templateResult: function (option) {
              if (!option.id) {
                return option.text;
              }

              var $option = $(
                '<span class="select2-option"><input type="checkbox" class="select2-option-checkbox" />' +
                  option.text +
                  "</span>"
              );
              return $option;
            },
            templateSelection: function (option) {
              if (!option.id) {
                return option.text;
              }

              return $(
                '<span class="select2-option"><input type="checkbox" class="select2-option-checkbox" checked />' +
                  option.text +
                  "</span>"
              );
            },
            closeOnSelect: false,
            dropdownParent: select.parent(),
            multiple: true,
          });

          // Event listener for change event
          select.on("change", function () {
            var selectedOptions = $(this).find(":selected");
            var selectedCoordinates = [];

            selectedOptions.each(function () {
              selectedCoordinates.push($(this).data("coordinates"));
            });

            // Use the selected coordinates to draw on the map
            console.log("Selected coordinates:", selectedCoordinates);

            drawCoordinatesOnMap(selectedCoordinates);
          });
        });
      }

      function loadDepartments() {
        $.getJSON("API-Responses/all-project-data.json", function (data) {
          var select = $("#departments");

          select.empty();

          $.each(data.data.depData, function (index, item) {
            select.append(
              $("<option>", {
                value: item.department_id,
                text: item.department_name,
              })
            );
          });

          select.select2();
        });
      }

      function drawCoordinatesOnMap(selectedCoordinates) {
        // Assuming you have a Leaflet map instance named 'map'
        // Clear previous layers from the map
        map.eachLayer(function (layer) {
          if (!(layer instanceof L.TileLayer)) {
            map.removeLayer(layer);
          }
        });

        // Loop through each set of coordinates and draw them on the map
        // Loop through each set of coordinates and draw them on the map
        selectedCoordinates.forEach(function (geometry) {
          var type = geometry.type;
          var coordinates = geometry.coordinates;

          if (type === "Polygon") {
            // For polygons
            var polygon = L.polygon(coordinates, {
              color: "red",
              fillColor: "transparent",
              fillOpacity: 0.1,
            }).addTo(map);

            // Fit the map bounds to the polygon
            map.fitBounds(polygon.getBounds());
          } else if (type === "MultiPolygon") {
            // For multi-polygons
            coordinates.forEach(function (polygonCoords) {
              var polygon = L.polygon(polygonCoords, {
                color: "red",
                fillColor: "transparent",
                fillOpacity: 0.1,
              }).addTo(map);

              // Fit the map bounds to the polygon
              map.fitBounds(polygon.getBounds());
            });
          }
        });
      }
    </script>
  </body>
</html>
