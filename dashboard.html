<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PMC</title>
    <link rel="stylesheet" href="style.css" />
    <!-- bootstrap -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdn.datatables.net/1.13.7/css/dataTables.bootstrap5.min.css"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
      crossorigin="anonymous"
    ></script>

    <!-- fontawsome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
      integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/js/all.min.js"
      integrity="sha512-GWzVrcGlo0TxTRvz9ttioyYJ+Wwk9Ck0G81D+eO63BaqHaJ3YZX9wuqjwgfcV/MrB2PhaVX9DkYVhbFpStnqpQ=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <!-- leaflet -->
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
      integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
      crossorigin=""
    />

    <!-- leaflet -->
    <script
      src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
      integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
      crossorigin=""
    ></script>

    <!-- to geojson -->
    <script src="https://unpkg.com/togeojson@1.1.0/togeojson.js"></script>

    <!-- leaflet-ajax -->
    <script src="https://unpkg.com/leaflet-ajax/dist/leaflet.ajax.min.js"></script>

    <!-- fontawsome -->
    <link
      rel="stylesheet"
      href="https://pro.fontawesome.com/releases/v5.10.0/css/all.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
      integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>

    <!-- Leflet for adding draw tool start-->
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

    <!-- Leaflet JavaScript -->
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

    <!-- Leaflet.draw CSS -->
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet-draw/dist/leaflet.draw.css"
    />

    <!-- Leaflet.draw JavaScript -->
    <script src="https://unpkg.com/leaflet-draw/dist/leaflet.draw.js"></script>

    <!-- Esri Leaflet JavaScript -->
    <script src="https://cdn-geoweb.s3.amazonaws.com/esri-leaflet/0.0.1-beta.5/esri-leaflet.js"></script>

    <!-- Esri Leaflet Geocoder JavaScript -->
    <script src="https://cdn-geoweb.s3.amazonaws.com/esri-leaflet-geocoder/0.0.1-beta.5/esri-leaflet-geocoder.js"></script>

    <!-- Esri Leaflet Geocoder CSS -->
    <link
      rel="stylesheet"
      type="text/css"
      href="https://cdn-geoweb.s3.amazonaws.com/esri-leaflet-geocoder/0.0.1-beta.5/esri-leaflet-geocoder.css"
    />

    <!-- Include jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

    <!-- Leflet for adding draw tool END -->

    <script src="https://unpkg.com/@turf/turf@6.3.0/turf.min.js"></script>

    <script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.7/js/dataTables.bootstrap5.min.js"></script>

    <!-- html2pdfcdn -->
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"
      integrity="sha512-GsLlZN/3F2ErC5ifS5QtgpiJtWd43JWSuIgh7mbzZ8zBps+dvLusV+eNQATqgA/HdeKFVgA5v3S/cIrLF7QnIg=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>

    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.0/jspdf.umd.min.js"></script> -->

    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.3.1/jspdf.umd.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
    <link
      rel="stylesheet"
      href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"></script>
    <style>
      .multi-checkboxes_wrap:before {
        font-family: fontAwesome;
        color: #999;
        content: "\f096";
        width: 25px;
        height: 25px;
        padding-right: 10px;
      }
      .multi-checkboxes_wrap[aria-selected="true"]:before {
        content: "\f14a";
      }
      .form-group label {
        font-size: 12px;
        font-weight: 600;
        margin-left: 0px;
      }
    </style>
  </head>
  <body>
    <div class="container-fluid">
      <header class="bg-secondary">
        <nav class="navbar navbar-expand-lg bg-body-tertiary">
          <div class="container-fluid">
            <a class="navbar-brand" href="#">Geopulse</a>
            <button
              class="navbar-toggler"
              type="button"
              data-bs-toggle="collapse"
              data-bs-target="#navbarSupportedContent"
              aria-controls="navbarSupportedContent"
              aria-expanded="false"
              aria-label="Toggle navigation"
            >
              <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
              <ul class="navbar-nav me-auto mb-2 mb-lg-0"></ul>
              <form class="d-flex" role="search">
                <input
                  class="form-control me-2"
                  type="search"
                  placeholder="Search"
                  aria-label="Search"
                  id="searchInput"
                />
                <div
                  id="autocompleteSuggestions"
                  class="autocomplete-suggestions"
                ></div>

                <button class="btn btn-outline-success" type="submit">
                  Clear
                </button>
              </form>
              <button id="showTableBtn" class="btn btn-outline-secondary ms-2">
                <i class="fa fa-map"></i>
              </button>
            </div>
          </div>
        </nav>
      </header>

      <div class="row">
        <!-- Left Sidebar -->
        <div class="col-md-2" style="background-color: #bbb">
          <div class="form-group mt-5">
            <label>Select Year</label>
            <select
              class="select2 form-control"
              multiple="multiple"
              id="project_fi"
            ></select>
          </div>
          <!-- <div class="form-group mt-5">
            <label>Layers Name (Amount)</label>
            <select class="select2 form-control" multiple="multiple"></select>
          </div> -->
          <div class="form-group mt-5">
            <label>Zone Name</label>
            <select
              class="form-control"
              multiple="multiple"
              id="zones"
            ></select>
          </div>
          <div class="form-group mt-5">
            <label for="admin_ward_name">Ward Name</label>
            <select
              class="select2 form-control"
              multiple="multiple"
              id="admin_ward_name"
            ></select>
          </div>
          <div class="form-group mt-5">
            <label>Village Name</label>
            <select
              class="form-control"
              multiple="multiple"
              id="villages"
            ></select>
          </div>
        </div>

        <!-- Main Content -->
        <div class="col-md-8">
          <main>
            <div id="map"></div>
          </main>
        </div>

        <!-- Right Sidebar -->
        <div class="col-md-2" style="background-color: #bbb">
          <div class="form-group mt-4">
            <div class="accordion" id="projectCostAccordion">
              <div class="accordion-item">
                <h2 class="accordion-header" id="projectCostHeading">
                  <button
                    class="accordion-button collapsed"
                    type="button"
                    data-bs-toggle="collapse"
                    data-bs-target="#projectCostCollapse"
                    aria-expanded="false"
                    aria-controls="projectCostCollapse"
                  >
                    Project Cost
                  </button>
                </h2>
                <div
                  id="projectCostCollapse"
                  class="accordion-collapse collapse"
                  aria-labelledby="projectCostHeading"
                  data-bs-parent="#projectCostAccordion"
                >
                  <div class="accordion-body">
                    <div class="form-group">
                      <div class="row">
                        <div class="col-md-12">
                          <select class="form-select" id="amount_comparison">
                            <option value="greater_than">Greater Than</option>
                            <option value="less_than">Less Than</option>
                          </select>
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-md-12 mt-3">
                          <input
                            type="text"
                            class="form-control"
                            id="amount_value"
                            placeholder="Enter amount"
                          />
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="form-group mt-4">
            <label for="date_range">Date Range</label>
            <input
              type="text"
              class="form-control"
              id="date_range"
              placeholder="Select Date Range"
              readonly
            />
          </div>

          <div class="form-group mt-4">
            <label for="admin_ward_name">Departments</label>
            <select
              class="form-control"
              id="departments"
              multiple="multiple"
            ></select>
          </div>
          <div class="form-group mt-4">
            <label>Project Status</label>
            <select
              class="select2 form-control"
              multiple="multiple"
              id="stage"
            ></select>
          </div>
          <div class="form-group mt-4">
            <label>Work Type</label>
            <select
              class="select2 form-control"
              multiple="multiple"
              id="work_type"
            ></select>
          </div>
          <!-- <div class="form-group mt-4">
            <label>Select With Radius</label>
            <select class="select2 form-control" multiple="multiple"></select>
          </div>
          <div class="form-group mt-4">
            <label>Catchment Area</label>
            <select class="select2 form-control" multiple="multiple"></select>
          </div> -->
        </div>
      </div>

      <div id="table-container-dashboard">
        <button id="closeTableBtnDashboard" class="close-button">
          <i class="fas fa-times"></i>
        </button>

        <table
          id="workTableDashboard"
          class="table table-bordered table-hover"
          style="width: 100% !important"
        >
          <thead>
            <tr>
              <th>Zone</th>
              <th>Ward</th>
              <th>Department</th>
              <th>Ward Scope</th>
              <th>Ward Name</th>
              <th>Work Type</th>
              <th>Date</th>
              <th>Tender Amount</th>
              <th>JE Name</th>
            </tr>
          </thead>
          <tfoot>
            <tr>
              <th>Zone</th>
              <th>Ward</th>
              <th>Department</th>
              <th>Ward Scope</th>
              <th>Ward Name</th>
              <th>Work Type</th>
              <th>Date</th>
              <th>Tender Amount</th>
              <th>JE Name</th>
            </tr>
          </tfoot>
          <tbody></tbody>
        </table>
        <div class="row" style="background-color: #ffffff; padding: 45px 15px">
          <div class="col-md-6">
            <canvas id="myPieChart" width="500" height="500"></canvas>
          </div>
          <div class="col-md-6">
            <canvas id="myLineChart" width="600" height="500"></canvas>
          </div>
        </div>
      </div>
    </div>
    <script src="index.js"></script>
    <script src="select2.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- JavaScript -->
    <!-- JavaScript -->
    <script>
      $(document).ready(function () {
        var amountValueInput = document.getElementById("amount_value");

        amountValueInput.addEventListener("keyup", function (event) {
          if (event.keyCode === 13) {
            filterDataAndDrawMap();
          }
        });
        $("#date_range")
          .datepicker({
            format: "yyyy-mm-dd",
            autoclose: false,
            todayHighlight: true,
            clearBtn: true,
            multidate: true,
            multidateSeparator: " to ",
            forceParse: false,
          })
          .on("changeDate", function (e) {
            var selectedDates = e.dates;
            if (selectedDates.length === 2) {
              var fromDate = selectedDates[0];
              var toDate = selectedDates[1];

              // Validate that toDate is greater than fromDate
              if (toDate <= fromDate) {
                alert("To date must be greater than From date.");
                // Clear the selected dates
                $("#date_range").datepicker("clearDates");
              }
              filterDataAndDrawMap();
              // yourFunction(selectedDates[0], selectedDates[1]);
              $("#date_range").datepicker("hide");
            }
          });
      });
    </script>

    <script>
      $(document).ready(function () {
        loadAllData();
      });

      function loadAllData() {
        $.getJSON("APIS/IWMS_DATA.php", function (data) {
          allData = data;
          loadInitialData();
        });
      }

      function loadInitialData() {
        loadAdminWardName();
        loadZones();
        loadVillages();
        loadDepartments();
        loadWorkTypes();
        loadProjectFi();
        loadStage();
      }

      function filterDataAndDrawMap() {
        var selectedDepartments = $("#departments").val();
        var selectedWorkTypes = $("#work_type").val();
        var selectedZones = $("#zones").val();
        var selectedWards = $("#admin_ward_name").val();
        var selectedProjectFi = $("#project_fi").val();
        var selectedStage = $("#stage").val();
        var selectedDateRange = $("#date_range").val();
        var selectedAmountComparison = $("#amount_comparison").val();
        var selectedAmountValue = $("#amount_value").val();

        // Check if any filter values are not empty
        if (
          !$.isEmptyObject(selectedDepartments) ||
          !$.isEmptyObject(selectedWorkTypes) ||
          !$.isEmptyObject(selectedZones) ||
          !$.isEmptyObject(selectedWards) ||
          !$.isEmptyObject(selectedStage) ||
          !$.isEmptyObject(selectedDateRange) ||
          !$.isEmptyObject(selectedAmountValue) ||
          !$.isEmptyObject(selectedProjectFi)
        ) {
          // Filter data based on selected filters
          var filteredData = filterData(
            selectedDepartments,
            selectedWorkTypes,
            selectedZones,
            selectedWards,
            selectedProjectFi,
            selectedStage,
            selectedDateRange,
            selectedAmountValue,
            selectedAmountComparison
          );

          // Extract coordinates from filtered data
          var allCoordinates = [];
          $("#workTableDashboard tbody").html("");
          $.each(filteredData.projects_data, function (index, project) {
            var proData = `<tr>
                    <td>${project.zone}</td>
                    <td>${project.ward}</td>
                    <td>${project.departme_1}</td>
                    <td>${project.ward}</td>
                    <td>${project.ward}</td>
                    <td>${project.work_type}</td>
                    <td>${project.created_at}</td>
                    <td>${project.tender_amo}</td>
                    <td>${project.je_name}</td>
                </tr>`;
            $("#workTableDashboard tbody").append(proData);
            if (project.geom) {
              let geometryCoordinates = JSON.parse(project.geom);
              allCoordinates.push(geometryCoordinates);
            }
          });
          var tableContainer = $("#table-container-dashboard");
          tableContainer.slideDown();

          $("#closeTableBtnDashboard").click(function () {
            tableContainer.slideUp();
          });

          console.log("All coordinates:", allCoordinates);

          // Draw coordinates on map
          drawCoordinatesOnMap(allCoordinates);
        } else {
          console.log("No filters selected. Map will not be drawn.");
        }
      }

      function filterData(
        selectedDepartments,
        selectedWorkTypes,
        selectedZones,
        selectedWards,
        selectedProjectFi,
        selectedStage,
        selectedDateRange,
        selectedAmountValue,
        selectedAmountComparison
      ) {
        // Parse the selected date range string to extract start and end dates if provided
        var startDate, endDate;
        if (selectedDateRange) {
          var dateRangeParts = selectedDateRange.split(" to ");
          startDate = new Date(dateRangeParts[0]);
          endDate = new Date(dateRangeParts[1]);
        }

        // Filter data based on selected filters
        var filteredData = {
          projects_data: [],
        };

        $.each(allData.projects_data, function (index, project) {
          var dateInRange = true;
          if (selectedDateRange) {
            // Check if the project date is within the provided date range
            var projectDate = new Date(project.created_at.replace(/-/g, "/"));
            dateInRange = projectDate >= startDate && projectDate <= endDate;
          }

          var amountComparisonValid = true;
          if (!$.isEmptyObject(selectedAmountValue)) {
            // Apply the amount comparison only if selectedAmountValue is not null
            if (selectedAmountComparison === "greater_than") {
              amountComparisonValid =
                parseFloat(project.tender_amo) >
                parseFloat(selectedAmountValue);
            } else if (selectedAmountComparison === "less_than") {
              amountComparisonValid =
                parseFloat(project.tender_amo) <
                parseFloat(selectedAmountValue);
            }
          }

          if (
            (selectedDepartments.length === 0 ||
              selectedDepartments.includes(project.departme_1)) &&
            (selectedWorkTypes.length === 0 ||
              selectedWorkTypes.includes(project.work_type)) &&
            (selectedZones.length === 0 ||
              selectedZones.includes(project.zone)) &&
            (selectedWards.length === 0 ||
              selectedWards.includes(project.ward)) &&
            (selectedStage.length === 0 ||
              selectedStage.includes(project.stage)) &&
            (selectedProjectFi.length === 0 ||
              selectedProjectFi.includes(project.project_fi)) &&
            dateInRange &&
            amountComparisonValid
          ) {
            filteredData.projects_data.push(project);
          }
        });

        return filteredData;
      }

      function loadAdminWardName() {
        var select = $("#admin_ward_name");
        select.empty();

        // Populate select options with all zones
        $.each(allData.wards, function (index, item) {
          select.append(
            $("<option>", {
              value: item,
              text: item,
            })
          );
        });

        // Destroy the existing Select2 instance, if it exists
        if (select.hasClass("select2-hidden-accessible")) {
          select.select2("destroy");
        }

        // Initialize Select2 with the updated options
        select.select2({
          templateResult: function (option) {
            if (!option.id) {
              return option.text;
            }

            var $option = $(
              '<span class="select2-option"><input type="checkbox" class="select2-option-checkbox" />' +
                option.text +
                "</span>"
            );
            return $option;
          },
          templateSelection: function (option) {
            if (!option.id) {
              return option.text;
            }

            return $(
              '<span class="select2-option"><input type="checkbox" class="select2-option-checkbox" checked />' +
                option.text +
                "</span>"
            );
          },
          closeOnSelect: false,
          dropdownParent: select.parent(),
          multiple: true,
        });

        // Event listener for change event
        select.on("change", function () {
          filterDataAndDrawMap();
        });
      }

      function loadZones() {
        var select = $("#zones");
        select.empty();

        // Populate select options with all zones
        $.each(allData.zones, function (index, item) {
          select.append(
            $("<option>", {
              value: item,
              text: item,
            })
          );
        });

        // Destroy the existing Select2 instance, if it exists
        if (select.hasClass("select2-hidden-accessible")) {
          select.select2("destroy");
        }

        // Initialize Select2 with the updated options
        select.select2({
          templateResult: function (option) {
            if (!option.id) {
              return option.text;
            }

            var $option = $(
              '<span class="select2-option"><input type="checkbox" class="select2-option-checkbox" />' +
                option.text +
                "</span>"
            );
            return $option;
          },
          templateSelection: function (option) {
            if (!option.id) {
              return option.text;
            }

            return $(
              '<span class="select2-option"><input type="checkbox" class="select2-option-checkbox" checked />' +
                option.text +
                "</span>"
            );
          },
          closeOnSelect: false,
          dropdownParent: select.parent(),
          multiple: true,
        });

        // Event listener for change event
        select.on("change", function () {
          // var selectedZones = $("#zones").val();
          // loadAdminWardName(selectedZones);
          filterDataAndDrawMap();
        });
      }

      function loadVillages() {
        $.getJSON("APIS/Village_Boundary.php", function (data) {
          var select = $("#villages");

          select.empty();

          $.each(data, function (index, item) {
            select.append(
              $("<option>", {
                value: item.fid,
                text: item.Village_Name,
                "data-coordinates": item.geom,
              })
            );
          });

          // Trigger change event when the select box is loaded
          select.trigger("change");
          select.select2({
            templateResult: function (option) {
              if (!option.id) {
                return option.text;
              }

              var $option = $(
                '<span class="select2-option"><input type="checkbox" class="select2-option-checkbox" />' +
                  option.text +
                  "</span>"
              );
              return $option;
            },
            templateSelection: function (option) {
              if (!option.id) {
                return option.text;
              }

              return $(
                '<span class="select2-option"><input type="checkbox" class="select2-option-checkbox" checked />' +
                  option.text +
                  "</span>"
              );
            },
            closeOnSelect: false,
            dropdownParent: select.parent(),
            multiple: true,
          });

          // Event listener for change event
          select.on("change", function () {
            var selectedOptions = $(this).find(":selected");
            var selectedCoordinates = [];

            selectedOptions.each(function () {
              selectedCoordinates.push($(this).data("coordinates"));
            });

            // Use the selected coordinates to draw on the map
            console.log("Selected coordinates:", selectedCoordinates);

            drawCoordinatesOnMap(selectedCoordinates);
          });
        });
      }

      function loadDepartments() {
        var select = $("#departments");
        select.empty();

        // Populate select options with department names from allData
        $.each(allData.department_names, function (index, item) {
          select.append(
            $("<option>", {
              value: item,
              text: item,
            })
          );
        });

        select.trigger("change");

        // Initialize Select2 with checkboxes and multiple mode
        select.select2({
          templateResult: function (option) {
            if (!option.id) {
              return option.text;
            }

            var $option = $(
              '<span class="select2-option"><input type="checkbox" class="select2-option-checkbox" />' +
                option.text +
                "</span>"
            );
            return $option;
          },
          templateSelection: function (option) {
            if (!option.id) {
              return option.text;
            }

            return $(
              '<span class="select2-option"><input type="checkbox" class="select2-option-checkbox" checked />' +
                option.text +
                "</span>"
            );
          },
          closeOnSelect: false,
          dropdownParent: select.parent(),
          multiple: true,
        });

        // Event listener for change event
        select.on("change", function () {
          filterDataAndDrawMap();
        });
      }

      function loadWorkTypes() {
        var select = $("#work_type");
        select.empty();

        // Populate select options with work types from allData
        $.each(allData.work_types, function (index, item) {
          select.append(
            $("<option>", {
              value: item,
              text: item,
            })
          );
        });

        select.trigger("change");

        // Initialize Select2 with checkboxes and multiple mode
        select.select2({
          templateResult: function (option) {
            if (!option.id) {
              return option.text;
            }

            var $option = $(
              '<span class="select2-option"><input type="checkbox" class="select2-option-checkbox" />' +
                option.text +
                "</span>"
            );
            return $option;
          },
          templateSelection: function (option) {
            if (!option.id) {
              return option.text;
            }

            return $(
              '<span class="select2-option"><input type="checkbox" class="select2-option-checkbox" checked />' +
                option.text +
                "</span>"
            );
          },
          closeOnSelect: false,
          dropdownParent: select.parent(),
          multiple: true,
        });

        // Event listener for change event
        select.on("change", function () {
          filterDataAndDrawMap();
        });
      }

      function loadProjectFi() {
        var select = $("#project_fi");
        select.empty();

        // Populate select options with all zones
        $.each(allData.project_fi, function (index, item) {
          select.append(
            $("<option>", {
              value: item,
              text: item,
            })
          );
        });

        // Destroy the existing Select2 instance, if it exists
        if (select.hasClass("select2-hidden-accessible")) {
          select.select2("destroy");
        }

        // Initialize Select2 with the updated options
        select.select2({
          templateResult: function (option) {
            if (!option.id) {
              return option.text;
            }

            var $option = $(
              '<span class="select2-option"><input type="checkbox" class="select2-option-checkbox" />' +
                option.text +
                "</span>"
            );
            return $option;
          },
          templateSelection: function (option) {
            if (!option.id) {
              return option.text;
            }

            return $(
              '<span class="select2-option"><input type="checkbox" class="select2-option-checkbox" checked />' +
                option.text +
                "</span>"
            );
          },
          closeOnSelect: false,
          dropdownParent: select.parent(),
          multiple: true,
        });

        // Event listener for change event
        select.on("change", function () {
          filterDataAndDrawMap();
        });
      }

      function loadStage() {
        var select = $("#stage");
        select.empty();

        // Populate select options with all zones
        $.each(allData.stage, function (index, item) {
          select.append(
            $("<option>", {
              value: item,
              text: item,
            })
          );
        });

        // Destroy the existing Select2 instance, if it exists
        if (select.hasClass("select2-hidden-accessible")) {
          select.select2("destroy");
        }

        // Initialize Select2 with the updated options
        select.select2({
          templateResult: function (option) {
            if (!option.id) {
              return option.text;
            }

            var $option = $(
              '<span class="select2-option"><input type="checkbox" class="select2-option-checkbox" />' +
                option.text +
                "</span>"
            );
            return $option;
          },
          templateSelection: function (option) {
            if (!option.id) {
              return option.text;
            }

            return $(
              '<span class="select2-option"><input type="checkbox" class="select2-option-checkbox" checked />' +
                option.text +
                "</span>"
            );
          },
          closeOnSelect: false,
          dropdownParent: select.parent(),
          multiple: true,
        });

        // Event listener for change event
        select.on("change", function () {
          filterDataAndDrawMap();
        });
      }

      function drawCoordinatesOnMap(selectedCoordinates) {
        // Assuming you have a Leaflet map instance named 'map'

        // Clear previous layers from the map
        map.eachLayer(function (layer) {
          if (!(layer instanceof L.TileLayer)) {
            map.removeLayer(layer);
          }
        });

        // Loop through each set of coordinates and draw them on the map
        selectedCoordinates.forEach(function (geometry) {
          var type = geometry.type;
          var coordinates = geometry.coordinates;

          coordinates = coordinates.map(function (coord) {
            return [coord[1], coord[0]]; // Swap longitude and latitude
          });

          if (type === "Polygon" || type === "MultiPolygon") {
            // For both polygons and multi-polygons
            var polygon = L.geoJSON(geometry, {
              style: function (feature) {
                return {
                  color: "red",
                  fillColor: "transparent",
                  fillOpacity: 0.1,
                };
              },
            }).addTo(map);

            // Fit the map bounds to the polygon
            map.fitBounds(polygon.getBounds());
          } else if (type === "MultiLineString") {
            // For both LineString and MultiLineString
            var polyline = L.geoJSON(geometry, {
              style: function (feature) {
                return {
                  color: "black", // Change color to black for roads
                  weight: 5, // Increase weight for road-like appearance
                  dashArray: "10, 10", // Add a dash array for a dashed line appearance
                };
              },
            }).addTo(map);

            // Fit the map bounds to the polyline
            map.fitBounds(polyline.getBounds());
          } else if (type === "LineString") {
            // For both LineString and MultiLineString
            var polyline = L.geoJSON(geometry, {
              style: function (feature) {
                return {
                  color: "blue", // Change color to black for roads
                  weight: 2, // Increase weight for road-like appearance
                };
              },
            }).addTo(map);

            // Fit the map bounds to the polyline
            map.fitBounds(polyline.getBounds());
          }
        });
      }

      // function getSelectedZones(selectedZones) {
      //   // Convert the array to a Set to remove duplicates
      //   const uniqueZones = [...new Set(selectedZones)];
      //   loadAdminWardName(selectedZones);
      // }
    </script>
    <script>
      // Get the canvas element
      var ctx = document.getElementById("myPieChart").getContext("2d");

      // Create the pie chart
      var myPieChart = new Chart(ctx, {
        type: "pie",
        data: {
          labels: ["Red", "Blue", "Yellow", "Green", "Purple"],
          datasets: [
            {
              label: "# of Votes",
              data: [12, 19, 3, 5, 2],
              backgroundColor: [
                "rgba(255, 99, 132, 0.5)",
                "rgba(54, 162, 235, 0.5)",
                "rgba(255, 206, 86, 0.5)",
                "rgba(75, 192, 192, 0.5)",
                "rgba(153, 102, 255, 0.5)",
              ],
              borderColor: [
                "rgba(255, 99, 132, 1)",
                "rgba(54, 162, 235, 1)",
                "rgba(255, 206, 86, 1)",
                "rgba(75, 192, 192, 1)",
                "rgba(153, 102, 255, 1)",
              ],
              borderWidth: 1,
            },
          ],
        },
        options: {
          responsive: false, // Set to true if you want the chart to resize with the window
        },
      });
    </script>
    <script>
      // Get the canvas element
      var ctx = document.getElementById("myLineChart").getContext("2d");

      // Create the line chart
      var myLineChart = new Chart(ctx, {
        type: "line",
        data: {
          labels: [
            "January",
            "February",
            "March",
            "April",
            "May",
            "June",
            "July",
          ],
          datasets: [
            {
              label: "My Dataset",
              data: [65, 59, 80, 81, 56, 55, 40], // Sample data for the line chart
              fill: false, // Fill area under the line
              borderColor: "rgb(75, 192, 192)", // Line color
              tension: 0.1, // Line tension (0 is straight lines, 1 is smooth curves)
            },
          ],
        },
        options: {
          responsive: false, // Set to true if you want the chart to resize with the window
        },
      });
    </script>
  </body>
</html>
